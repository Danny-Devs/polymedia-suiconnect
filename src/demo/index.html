<!DOCTYPE html>
<html>
<head>
    <title>SuiConnect Demo</title>
    <!-- 1. Load SuiConnect -->
    <link rel="stylesheet" href="https://suiconnect.polymedia.app/assets/index.css">
    <script defer src="https://suiconnect.polymedia.app/assets/index.js" onload="window.suiconnectInit()"></script>
</head>
<body>
    <h2>SuiConnect Demo</h2>

    <!-- 2. Add the wallet button container (contents will be replaced by SuiConnect) -->
    <div id="suiconnect-root">
        <div id="suiconnect">
            <button disabled class="btn connect">CONNECT WALLET</button>
        </div>
    </div>

    <!-- Example UI -->
    <div style="margin: 10px 0;">
        Status: <span id="status">Disconnected</span>
    </div>

    <div id="actions" style="display: none; margin-top: 20px;">
        <h3>Actions:</h3>
        <button onclick="getSuiBalance()">Get Balance</button>
        <button onclick="signMessage()">Sign Message</button>
        <button onclick="signAndExecuteTx()">Execute Transaction</button>
    </div>

    <!-- 3. Handle wallet connect/disconnect -->
    <script>
        window.addEventListener("suiconnect-wallet-change", yourHandler);

        // === Example handler and Sui wallet / RPC actions ===

        let suiConnect = null;

        function yourHandler(event) {
            suiConnect = event.detail;
            updateUI();
        }

        function updateUI() {
            const status = document.getElementById('status');
            const actions = document.getElementById("actions");

            const address = suiConnect.address;
            status.textContent = address
                ? `Connected as ${address.slice(0,6)}...${address.slice(-4)}`
                : 'Disconnected';
            actions.style.display = address ? "block" : "none";
        }

        async function getSuiBalance() {
            try {
                const client = new suiConnect.SuiClient({
                    url: "https://fullnode.mainnet.sui.io:443"
                });
                const balance = await client.getBalance({
                    owner: suiConnect.address,
                    coinType: "0x2::sui::SUI"
                });
                const totalBalance = Number(balance.totalBalance) / 1_000_000_000;
                alert(`Wallet balance: ${totalBalance.toFixed(2)} SUI`);
            } catch (error) {
                alert(error);
            }
        }

        async function signMessage() {
            try {
                const resp = await suiConnect.signPersonalMessage({
                    message: new TextEncoder().encode("Hey hey hey SuiConnect!"),
                });
                alert(`Message signed successfully:\n\n${JSON.stringify(resp, null, 2)}`);
            } catch (error) {
                alert(error);
            }
        }

        async function signAndExecuteTx() {
            try {
                const resp = await suiConnect.signAndExecuteTransaction({
                    transaction: new suiConnect.Transaction(),
                });
                alert(`Transaction executed successfully. Digest: ${resp.digest}`);
            } catch (error) {
                alert(error);
            }
        }
    </script>
</body>
</html>
