<!DOCTYPE html>
<html>
<head>
    <title>SuiConnect Demo</title>
    <!-- 1. Load SuiConnect CSS and JS -->
    <link rel="stylesheet" href="https://suiconnect.polymedia.app/assets/index.css">
    <script defer src="https://suiconnect.polymedia.app/assets/index.js" onload="window.suiconnectInit()"></script>
</head>
<body>
    <h2>SuiConnect Demo</h2>

    <!-- 2. The wallet button will appear here -->
    <div id="suiconnect-root"></div>

    <div id="actions" style="display: none; margin-top: 20px;">
        <h3>Example actions:</h3>
        <button onclick="getSuiBalance()">Get Balance</button>
        <button onclick="signMessage()">Sign Message</button>
        <button onclick="signAndExecuteTx()">Execute Transaction</button>
    </div>

    <!-- 3. Handle wallet connections -->
    <script>
        let suiConnect = null;
        window.addEventListener("suiconnect-wallet-change", (event) => {
            suiConnect = event.detail;
            showOrHideActions();
            console.log("[handler] connected wallet:", suiConnect.address);
        });

        function showOrHideActions() {
            const isConnected = !!suiConnect.address;
            document.getElementById("actions").style.display = isConnected ? "block" : "none";
        }
    </script>

    <!-- Example actions -->
    <script>
        async function getSuiBalance() {
            const client = new suiConnect.SuiClient({ url: "https://fullnode.mainnet.sui.io:443" });
            try {
                const balance = await client.getBalance({
                    owner: suiConnect.address,
                    coinType: "0x2::sui::SUI"
                });
                const totalBalance = Number(balance.totalBalance) / 1_000_000_000;
                alert(`Wallet balance: ${totalBalance.toFixed(2)} SUI`);
            } catch (error) {
                alert(error);
            }
        }

        async function signMessage() {
            try {
                const resp = await suiConnect.signPersonalMessage({
                    message: new TextEncoder().encode("Hey hey hey SuiConnect!"),
                });
                alert(`Message signed successfully:\n\n${JSON.stringify(resp, null, 2)}`);
            } catch (error) {
                alert(error);
            }
        }

        async function signAndExecuteTx() {
            try {
                const resp = await suiConnect.signAndExecuteTransaction({
                    transaction: new suiConnect.Transaction(),
                });
                alert(`Transaction executed successfully. Digest: ${resp.digest}`);
            } catch (error) {
                alert(error);
            }
        }
    </script>
</body>
</html>
