<!DOCTYPE html>
<html>
<head>
    <title>SuiConnect Demo</title>
    <!-- 1. Load SuiConnect CSS and JS -->
    <!-- TODO uncomment when ready -->
    <!-- <link rel="stylesheet" href="https://suiconnect.polymedia.app/assets/index.css">
    <script defer src="https://suiconnect.polymedia.app/assets/index.js" onload="window.suiconnectInit()"></script> -->

    <link rel="stylesheet" href="http://localhost:1234/assets/index.css">
    <script defer src="http://localhost:1234/assets/index.js" onload="window.suiconnectInit()"></script>
</head>
<body>
    <h2>SuiConnect Demo</h2>

    <!-- 2. The wallet button will appear here -->
    <div id="suiconnect-root"></div>

    <!-- 3. Handle wallet connections -->
    <script>
        window.addEventListener("suiconnect-wallet-change", (event) => {
            const {
                address, // string or null when not connected
                signPersonalMessage, // prompt the user to sign and execute a tx with their wallet
                signAndExecuteTransaction, // prompt the user to sign and execute a tx with their wallet
                signTransaction, // prompt the user to sign a tx with their wallet (to be executed by SuiCLient)
                SuiClient, // SuiClient class
                Transaction, // Transaction class
            } = event.detail;

            // address is a string or null when not connected
            console.log("[handler] connected wallet:", address);

            // SuiClient can be used to interact with Sui via RPC calls
            const client = new SuiClient({ url: "https://fullnode.mainnet.sui.io:443" });
            client.getLatestSuiSystemState().then(state => {
                console.log("[handler] current epoch:", state.epoch);
            });

            if (!address) return;

            // prompt the user to sign a message with their wallet
            signPersonalMessage({
                message: new TextEncoder().encode("Hey hey hey SuiConnect!"),
            }).then(result => {
                console.log("[handler] sign success:", result);
            }).catch(error => {
                console.warn("[handler] sign failed:", error);
            });

            // prompt the user to approve a transaction with their wallet
            // signAndExecuteTransaction({
            //     transaction: new Transaction(), // a tx that does nothing
            // }).then(result => {
            //     console.log("[handler] tx result:", result);
            // }).catch(error => {
            //     console.warn("[handler] tx error:", error);
            // });
        });
    </script>
</body>
</html>
