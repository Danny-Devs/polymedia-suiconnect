<!DOCTYPE html>
<html>
<head>
    <title>SuiConnect Demo</title>
    <!-- 1. Load SuiConnect CSS and JS -->
    <!-- TODO uncomment when ready -->
    <!-- <link rel="stylesheet" href="https://suiconnect.polymedia.app/assets/index.css">
    <script defer src="https://suiconnect.polymedia.app/assets/index.js" onload="window.suiconnectInit()"></script> -->

    <link rel="stylesheet" href="http://localhost:1234/assets/index.css">
    <script defer src="http://localhost:1234/assets/index.js" onload="window.suiconnectInit()"></script>
</head>
<body>
    <h2>SuiConnect Demo</h2>

    <!-- 2. The wallet button will appear here -->
    <div id="suiconnect-root"></div>

    <div id="actions" style="display: none; margin-top: 20px;">
        <button onclick="getEpoch()">Get Current Epoch</button>
        <button onclick="signMessage()">Sign Message</button>
        <button onclick="signAndExecuteTx()">Execute Transaction</button>
    </div>

    <!-- 3. Handle wallet connections -->
    <script>
        let suiConnect = null;
        window.addEventListener("suiconnect-wallet-change", (event) => {
            suiConnect = event.detail;
            showOrHideActions();
            console.log("[handler] connected wallet:", suiConnect.address);
        });

        function showOrHideActions() {
            const isConnected = !!suiConnect.address;
            document.getElementById("actions").style.display = isConnected ? "block" : "none";
        }

        // Action handlers
        async function getEpoch() {
            const client = new suiConnect.SuiClient({ url: "https://fullnode.mainnet.sui.io:443" });
            try {
                const state = await client.getLatestSuiSystemState();
                alert(`Current epoch: ${state.epoch}`);
            } catch (error) {
                alert(`Failed to get epoch: ${error}`);
            }
        }

        async function signMessage() {
            try {
                const result = await suiConnect.signPersonalMessage({
                    message: new TextEncoder().encode("Hey hey hey SuiConnect!"),
                });
                alert(`Message signed successfully: ${result}`);
            } catch (error) {
                alert(`Failed to sign message: ${error}`);
            }
        }

        async function signAndExecuteTx() {
            try {
                const result = await suiConnect.signAndExecuteTransaction({
                    transaction: new suiConnect.Transaction(),
                });
                alert("Transaction executed successfully:", result);
            } catch (error) {
                alert(`Failed to execute transaction: ${error}`);
            }
        }

    </script>
</body>
</html>
