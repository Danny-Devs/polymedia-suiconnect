<div class="assets-container">
  <div class="page-header">
    <h1>Digital Assets</h1>
    <p>View and manage your Sui blockchain assets</p>
  </div>

  <div class="assets-grid">
    <div class="balance-card card">
      <h3>Balance</h3>
      <div class="balance-amount">
        <span id="suiBalance">0.0000</span>
        <span class="currency">SUI</span>
      </div>
      <div class="balance-usd">â‰ˆ $<span id="usdBalance">0.00</span> USD</div>
    </div>

    <div class="nfts-section">
      <div class="section-header">
        <h3>NFTs</h3>
        <a href="#/create" class="btn btn-secondary">Create NFT</a>
      </div>
      <div id="nftGrid" class="grid">
        <div class="loading">Loading NFTs...</div>
      </div>
    </div>

    <div class="coins-section">
      <div class="section-header">
        <h3>Coins</h3>
      </div>
      <div id="coinGrid" class="grid">
        <div class="loading">Loading coins...</div>
      </div>
    </div>
  </div>
</div>

<style>
  .assets-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
  }

  .page-header {
    text-align: center;
    margin-bottom: 40px;
  }

  .balance-card {
    background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
    color: white;
    padding: 30px;
    border-radius: 16px;
    margin-bottom: 40px;
  }

  .balance-card h3 {
    margin: 0 0 20px 0;
    opacity: 0.9;
  }

  .balance-amount {
    font-size: 36px;
    font-weight: bold;
    margin-bottom: 10px;
  }

  .balance-amount .currency {
    font-size: 24px;
    opacity: 0.9;
    margin-left: 8px;
  }

  .balance-usd {
    font-size: 14px;
    opacity: 0.8;
  }

  .section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }

  .section-header h3 {
    margin: 0;
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 40px;
  }

  .nft-card,
  .coin-card {
    background: var(--bg);
    border-radius: 12px;
    overflow: hidden;
    transition: transform 0.2s ease;
  }

  .nft-card:hover,
  .coin-card:hover {
    transform: translateY(-4px);
  }

  .nft-image {
    width: 100%;
    height: 200px;
    background: var(--bg-secondary);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .nft-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .nft-details,
  .coin-details {
    padding: 15px;
  }

  .nft-details h4,
  .coin-details h4 {
    margin: 0 0 8px 0;
    font-size: 16px;
  }

  .nft-details p,
  .coin-details p {
    margin: 0;
    font-size: 14px;
    color: var(--text-secondary);
  }

  .coin-amount {
    font-size: 24px;
    font-weight: bold;
    margin-bottom: 8px;
  }

  .coin-symbol {
    font-size: 14px;
    opacity: 0.7;
    margin-left: 4px;
  }

  .loading {
    text-align: center;
    padding: 40px;
    color: var(--text-secondary);
    grid-column: 1 / -1;
  }

  @media (max-width: 768px) {
    .grid {
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    }
  }
</style>

<script>
  let suiPrice = 0;

  async function initAssetsPage() {
    if (!window.suiconnect?.address) {
      document.querySelector('.assets-container').innerHTML = `
            <div class="page-header">
                <h1>Connect Wallet</h1>
                <p>Please connect your wallet to view your digital assets</p>
            </div>
        `;
      return;
    }

    await Promise.all([loadSuiPrice(), loadNFTs(), loadCoins()]);
  }

  async function loadSuiPrice() {
    try {
      const response = await fetch(
        'https://api.coingecko.com/api/v3/simple/price?ids=sui&vs_currencies=usd'
      );
      const data = await response.json();
      suiPrice = data.sui.usd;
    } catch (error) {
      console.error('Error fetching SUI price:', error);
      suiPrice = 0;
    }
  }

  async function loadNFTs() {
    const nftGrid = document.getElementById('nftGrid');

    try {
      const { getOwnedObjects } = window.suiconnect;
      const nfts = await getOwnedObjects({
        filter: { type: 'nft' }
      });

      if (!nfts.length) {
        nftGrid.innerHTML = `
                <div class="empty-state">
                    <p>No NFTs found</p>
                    <a href="#/create" class="btn btn-secondary">Create your first NFT</a>
                </div>
            `;
        return;
      }

      nftGrid.innerHTML = nfts
        .map(
          nft => `
            <div class="nft-card card">
                <div class="nft-image">
                    ${
                      nft.image_url
                        ? `<img src="${nft.image_url}" alt="${nft.name}">`
                        : `<span class="placeholder">No Image</span>`
                    }
                </div>
                <div class="nft-details">
                    <h4>${nft.name || 'Untitled NFT'}</h4>
                    <p>${nft.description || 'No description'}</p>
                </div>
            </div>
        `
        )
        .join('');
    } catch (error) {
      nftGrid.innerHTML = `
            <div class="error">
                Error loading NFTs: ${error.message}
            </div>
        `;
    }
  }

  async function loadCoins() {
    const coinGrid = document.getElementById('coinGrid');
    const balanceElement = document.getElementById('suiBalance');
    const usdBalanceElement = document.getElementById('usdBalance');

    try {
      const { getBalance, getOwnedObjects } = window.suiconnect;
      const suiBalance = await getBalance();
      const coins = await getOwnedObjects({
        filter: { type: 'coin' }
      });

      // Update SUI balance
      const formattedBalance = (suiBalance / 1e9).toFixed(4);
      balanceElement.textContent = formattedBalance;
      usdBalanceElement.textContent = (formattedBalance * suiPrice).toFixed(2);

      if (!coins.length) {
        coinGrid.innerHTML = `
                <div class="empty-state">
                    <p>No coins found</p>
                </div>
            `;
        return;
      }

      coinGrid.innerHTML = coins
        .map(
          coin => `
            <div class="coin-card card">
                <div class="coin-details">
                    <div class="coin-amount">
                        ${(coin.balance / 1e9).toFixed(4)}
                        <span class="coin-symbol">${coin.symbol}</span>
                    </div>
                    <p>${coin.name || coin.symbol}</p>
                </div>
            </div>
        `
        )
        .join('');
    } catch (error) {
      coinGrid.innerHTML = `
            <div class="error">
                Error loading coins: ${error.message}
            </div>
        `;
    }
  }
</script>
