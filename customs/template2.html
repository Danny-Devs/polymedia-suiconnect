<style>
  .product {
      color: white;
      padding: 80px 0px;
      margin: 0 auto;
  }
  .product-flex {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 40px;
  }
  .product-container {
      width: 80%;
      margin: 0 auto;
  }
  .image-container {
      display: flex;
      justify-content: center;
      align-items: center;
  }
  .spin-viewer {
      width: 300px;
      height: 300px;
      border: 2px solid white;
      display: flex;
      justify-content: center;
      align-items: center;
  }
  .product-info {
      padding: 20px;
  }
  .product-info p {
      font-size: 14px;
  }
  h3 {
      font-size: 20px;
      color: white;
  }
  .buy-now-btn {
      display: inline-block;
      padding: 0px 25px;
      background-color: #9579ff;
      color: white;
      font-family: 'Louis George Cafe';
      text-decoration: none;
      border-radius: 100px;
      cursor: pointer;
  }
  .buy-now-btn h5 {
      margin: 0;
  }
  @media (max-width: 767px) {
      .product-flex {
          flex-direction: column;
          padding: 20px;
      }
      .spin-viewer {
          width: 250px;
          height: 250px;
      }
      .product-info {
          padding: 10px;
          text-align: center;
      }
      .buy-now-btn {
          margin-top: 10px;
      }
  }
</style>

<section class="product">
  <div class="product-container">
      <div class="product-flex">
          <div class="image-container">
              <div class="spin-viewer" id="spin-viewer">
                  <img id="spin-image" src="https://cdn.shopify.com/s/files/1/0867/2660/7180/files/spin1.jpg" alt="">
              </div>
          </div>
          <div class="product-info">
              <h3>THE PLUSHIE HAS ENTERED THE CHAT!</h3>
              <p>Only 2222 Kumo plushies available! <br>
              Equipped with NFC chips that unlock NFTs, rewards, and more.</p>
              <p>Pre-order today! Limited supply.</p>
              <button id="custom-cart-btn" class="buy-now-btn"><h5>Buy Now</h5></button>
          </div>
      </div>
  </div>
</section>

<script>
  // ShopiSui event handling
  window.addEventListener('nft-ownership-check', (event) => {
      const buyButton = document.getElementById('custom-cart-btn');
      if (!buyButton) { return; }
      if (event.detail.ownsNft) {
          buyButton.classList.remove('hidden');
      } else {
          buyButton.classList.add('hidden');
      }
  });

  // Popup Cart Trigger
  document.getElementById('custom-cart-btn').addEventListener('click', function () {
      const addToCartButton = document.querySelector('[name="add"]'); // Adjust for product form button
      if (addToCartButton) {
          addToCartButton.click();
      } else {
          console.error('Add to Cart button not found');
      }
  });

  // Image Spin Code
  const imageCount = 6; // Number of images
  const imageBaseURL = "https://cdn.shopify.com/s/files/1/0867/2660/7180/files/spin"; // Base URL of the images
  let currentFrame = 1;

  const spinImage = document.getElementById('spin-image');
  const spinViewer = document.getElementById('spin-viewer');

  let isDragging = false;
  let startX = 0;

  const debounceDrag = (() => {
      let timeout;
      return (callback, delay) => {
          clearTimeout(timeout);
          timeout = setTimeout(callback, delay);
      };
  })();

  function handleDrag(currentX) {
      let deltaX = currentX - startX;
      if (Math.abs(deltaX) > 5) {
          startX = currentX;
          currentFrame = (currentFrame + (deltaX > 0 ? 1 : -1) + imageCount - 1) % imageCount + 1;
          spinImage.src = `${imageBaseURL}${currentFrame}.jpg`;
      }
  }

  spinViewer.addEventListener('mousedown', (event) => {
      isDragging = true;
      startX = event.clientX;
      event.preventDefault();
  });

  spinViewer.addEventListener('touchstart', (event) => {
      isDragging = true;
      startX = event.touches[0].clientX;
      event.preventDefault();
  });

  document.addEventListener('mouseup', () => {
      isDragging = false;
  });

  document.addEventListener('touchend', () => {
      isDragging = false;
  });

  spinViewer.addEventListener('mousemove', (event) => {
      if (isDragging) debounceDrag(() => handleDrag(event.clientX), 10);
  });

  spinViewer.addEventListener('touchmove', (event) => {
      if (isDragging) debounceDrag(() => handleDrag(event.touches[0].clientX), 10);
  });
</script>
